<html>
<head>
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <script type="text/javascript" src="http://stats.maxifoot.com/0_app_mobile/js/jquery-1.10.2.min.js"></script>
</head>
<body>
<div id=alaune2></div>
<div id=log1></div>
<div id=log2></div>
<div id=log3></div>
<script type="text/javascript">
var titres1=new Array();
var chapo1=[];
var imgnom1=[];
var log2='';
localStorage.clear();
function convertImgToBase64(ida, url){
        log2+='entree convert ida='+ida+' url='+url+'<br>';
        var canvas = document.createElement('CANVAS');
        log2+='creation canva ok:'+canvas+'<br>';
        var ctx = canvas.getContext('2d');
        log2+='ctx ok ='+ctx+'<br>';
        var img = new Image;
        log2+='creation img ok='+img+'<br>';
        img.crossOrigin = '';
        img.addEventListener("load",function() {
                log2+='img loaded='+ida+' url='+url+'<br>';
                alert("load");
                canvas.height = img.height;
                canvas.width = img.width;
                $('#log3').html('canvas width='+img.width);
                ctx.drawImage(img,0,0);
                var dat1=canvas.toDataURL();
                log2+='donnees ok'+dat1+'<br>';
                $('#log3').html('data img='+dat1);
                localStorage.setItem('part'+ida, dat1);
                alert(dat1);
                $('#part'+ida).html('<img src="'+dat1+'">');
                canvas = null;
                // img = null;
        });
        img.src=url;
        log2+='img src='+img.src+'<br>';
}
$.ajax({
        url: "http://m.maxifoot.fr/json_all.php",
        crossDomain: true,
        dataType: 'json',
        success: function( data ) {
                console.log(data);
                var c1=data[0][0];
                var txt2='';
                var log1='';
                for (var i=12, l1=c1.length; i<l1; i++ ) {
                        var ida=c1[i][0];
                        if ((typeof ida)=='undefined') { continue; }
                        var txt0='<div id=part'+ida+'>photo'+ida+'</div>';
                        txt2+=txt0;
                }
                $('#alaune2').html(txt2);
                for (var i=12, l1=c1.length; i<l1; i++ ) {
                        var ida=c1[i][0];
                        if ((typeof ida)=='undefined') { continue; }
                        var imgdat1=localStorage.getItem('partu'+ida);
                        log1+='i='+i+' ida='+ida+' '+'<br>';
                        if (imgdat1==null) {
                                convertImgToBase64(ida,'http://photo.maxifoot.fr/'+c1[i][3]+'1.jpg');
                        }
                }
                $('#log1').html(log1);
                $('#log2').html(log2);
        }
});
</script>
</body>
</html>
