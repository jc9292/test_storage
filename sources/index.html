<html>
<head>
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <script type="text/javascript" src="http://stats.maxifoot.com/0_app_mobile/js/jquery-1.10.2.min.js"></script>
</head>
<body>
<div id=alaune2></div>
<div id=log1></div>
<div id=log2></div>
<script type="text/javascript">
localStorage.setItem('toto', 'ca marche');
alert(localStorage.getItem('toto'));
var titres1=new Array();
var chapo1=[];
var imgnom1=[];
var imgdat1=[];
var log2='';
function convertImgToBase64(ida, url){
        log2+='entree convert ida='+ida+' url='+url+'<br>';
        var canvas = document.createElement('CANVAS');
        log2+='creation canva ok:'+canvas+'<br>';
        var ctx = canvas.getContext('2d');
        log2+='ctx ok ='+ctx+'<br>';
        var img = new Image;
        log2+='creation img ok='+img+'<br>';
        img.crossOrigin = '';
        img.onload = function(){
                log2+='img loaded ('+ida+' url='+url+')br>';
                canvas.height = img.height;
                canvas.width = img.width;
                ctx.drawImage(img,0,0);
                var dat1=canvas.toDataURL();
                imgdat1[ida]=dat1;
                localStorage.setItem('part'+ida, dat1);
                // $('#part'+ida).attr("src",dat1);
                canvas = null;
                img = null;
        };
        img.src=url;
        log2+='img src='+img.src+'<br>';
}
$.ajax({
        url: "http://m.maxifoot.fr/json_all.php",
        crossDomain: true,
        dataType: 'json',
        success: function( data ) {
                console.log(data);
                var c1=data[0][0];
                var txt2='';
                var log1='';
                for (var i=12, l1=c1.length; i<l1; i++ ) {
                        var ida=c1[i][0];
                        if ((typeof ida)=='undefined') { continue; }
                        var txt0='<img width=135 height=90 id=part'+ida+' src="">';
                        imgdat1[ida]=localStorage.getItem('part'+ida);
                        log1+='i='+i+' ida='+ida+' '+imgdat1[ida]+'<br>';
                        if (imgdat1[ida]==null) {
                                convertImgToBase64(ida,'http://photo.maxifoot.fr/'+c1[i][3]+'1.jpg');
                        }
                        titres1[ida]=c1[i][1];
                        chapo1[ida]=c1[i][2];
                        imgnom1[ida]=c1[i][3];
                        txt2+=txt0;
                }
                $('#log1').html(log1);
                $('#alaune2').html(txt2);
                for (key in imgdat1) {
                        log2+='img'+key+'='+imgdat1[key]+'<br>';
                        $('#part'+key).attr("src",imgdat1[key]);
                }
                $('#log2').html(log2);
        }
});
</script>
</body>
</html>
